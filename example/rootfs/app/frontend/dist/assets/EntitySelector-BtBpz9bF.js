import{i as e,j as t,H as s,U as l,G as a,c as i,T as n,B as r,t as o,h as c,E as d,Z as h,k as m,n as u,L as p,l as x,m as j,a2 as f}from"./mui-bZH-AYFI.js";import{r as y,a as v}from"./vendor-DtzNP0b0.js";import{b as g}from"./utils-D1Jy8hEJ.js";import{r as z,u as b}from"./index-C0CMstuU.js";import{f as S,g as E,a as C}from"./helpers-F_j2KFUt.js";import"./state-MbgKLSXQ.js";var w={},M=e;Object.defineProperty(w,"__esModule",{value:!0});var H=w.default=void 0,k=M(z()),A=t;H=w.default=(0,k.default)((0,A.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var O={},P=e;Object.defineProperty(O,"__esModule",{value:!0});var I=O.default=void 0,_=P(z()),F=t;I=O.default=(0,_.default)((0,F.jsx)("path",{d:"M3 5h2V3c-1.1 0-2 .9-2 2m0 8h2v-2H3zm4 8h2v-2H7zM3 9h2V7H3zm10-6h-2v2h2zm6 0v2h2c0-1.1-.9-2-2-2M5 21v-2H3c0 1.1.9 2 2 2m-2-4h2v-2H3zM9 3H7v2h2zm2 18h2v-2h-2zm8-8h2v-2h-2zm0 8c1.1 0 2-.9 2-2h-2zm0-12h2V7h-2zm0 8h2v-2h-2zm-4 4h2v-2h-2zm0-16h2V3h-2zM7 17h10V7H7zm2-8h6v6H9z"}),"SelectAll");var L={},T=e;Object.defineProperty(L,"__esModule",{value:!0});var V=L.default=void 0,B=T(z()),W=t;V=L.default=(0,B.default)((0,W.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const $=({onSelectionChange:e,multiSelect:z=!0,title:w="Select Entities"})=>{const{entities:M,entityFilter:k,selectedEntities:A,loading:O,setEntityFilter:P,toggleEntitySelection:_,clearEntitySelection:F,selectAllEntities:L}=b(),[T,B]=y.useState(new Set(["light","switch"])),[W,$]=y.useState(k.search),[G]=g(W,300);v.useEffect(()=>{G!==k.search&&P({search:G})},[G,k.search,P]),v.useEffect(()=>{console.log("[EntitySelector] Entities received:",{count:M.length,entities:M,loading:O.entities})},[M,O.entities]),v.useEffect(()=>{console.log("[EntitySelector] Entity filter changed:",k)},[k]),v.useEffect(()=>{console.log("[EntitySelector] Selected entities:",{count:A.size,ids:Array.from(A)})},[A]);const N=y.useMemo(()=>Array.from(new Set(M.map(e=>e.id.split(".")[0]))).sort(),[M]),R=["on","off","unknown"],U=y.useMemo(()=>{const e=new Set;return M.forEach(t=>{t.state&&R.includes(t.state.toLowerCase())&&e.add(t.state.toLowerCase())}),Array.from(e).sort()},[M]),Y=y.useMemo(()=>{const e=S(M,k);return console.log("[EntitySelector] Filtered entities:",{total:M.length,filtered:e.length,filter:k}),e},[M,k]),Z=y.useMemo(()=>{const e=E(Y);return console.log("[EntitySelector] Grouped entities:",{types:Object.keys(e),counts:Object.entries(e).map(([e,t])=>({type:e,count:t.length}))}),e},[Y]),q=W!==G;return t.jsx(s,{children:t.jsx(l,{children:t.jsxs(a,{spacing:2,children:[t.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[t.jsx(n,{variant:"h6",children:w}),t.jsxs(i,{children:[t.jsx(r,{size:"small",startIcon:t.jsx(I,{}),onClick:()=>{L(),null==e||e(new Set(M.map(e=>e.id)))},disabled:!z,children:"Select All"}),t.jsx(r,{size:"small",startIcon:t.jsx(V,{}),onClick:()=>{F(),null==e||e(new Set)},disabled:0===A.size,children:"Clear"})]})]}),t.jsx(o,{fullWidth:!0,size:"small",placeholder:"Search entities...",value:W,onChange:e=>$(e.target.value),InputProps:{startAdornment:t.jsx(H,{sx:{mr:1,color:"action.active"}}),endAdornment:q?t.jsx(c,{size:20,sx:{color:"action.active"}}):null},helperText:q?"Searching...":""}),t.jsxs(i,{children:[t.jsx(n,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Filter by type (domain):"}),t.jsx(i,{display:"flex",gap:1,flexWrap:"wrap",sx:{maxHeight:150,overflowY:"auto"},children:N.map(e=>t.jsx(d,{label:e,size:"small",onClick:()=>(e=>{const t=k.domains.includes(e)?k.domains.filter(t=>t!==e):[...k.domains,e];P({domains:t})})(e),color:k.domains.includes(e)?"primary":"default",variant:k.domains.includes(e)?"filled":"outlined"},e))})]}),U.length>0&&t.jsxs(i,{children:[t.jsx(n,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Filter by status:"}),t.jsx(i,{display:"flex",gap:1,flexWrap:"wrap",children:U.map(e=>t.jsx(d,{label:e,size:"small",onClick:()=>(e=>{const t=k.states.includes(e)?k.states.filter(t=>t!==e):[...k.states,e];P({states:t})})(e),color:k.states.includes(e)?"secondary":"default",variant:k.states.includes(e)?"filled":"outlined"},e))})]}),t.jsxs(i,{display:"flex",gap:1,alignItems:"center",children:[A.size>0&&t.jsx(d,{label:`${A.size} selected`,color:"primary",size:"small"}),t.jsx(d,{label:`${Y.length} result${1!==Y.length?"s":""}`,color:"default",variant:"outlined",size:"small"})]}),t.jsx(h,{}),t.jsx(i,{sx:{maxHeight:500,overflow:"auto"},children:O.entities?t.jsx(n,{color:"text.secondary",align:"center",py:4,children:"Loading entities..."}):0===M.length?t.jsx(n,{color:"text.secondary",align:"center",py:4,children:"No entities available. Please connect to Home Assistant first."}):0===Object.entries(Z).length?t.jsx(n,{color:"text.secondary",align:"center",py:4,children:"No entities match your filters. Try adjusting the search or type filters."}):Object.entries(Z).map(([s,l])=>t.jsxs(i,{mb:2,children:[t.jsx(m,{button:!0,onClick:()=>(e=>{const t=new Set(T);t.has(e)?t.delete(e):t.add(e),B(t)})(s),sx:{bgcolor:"action.hover",borderRadius:1},children:t.jsx(u,{primary:t.jsxs(n,{variant:"subtitle2",children:[C(s)," ",s.toUpperCase()," (",l.length,")"]})})}),T.has(s)&&t.jsx(p,{dense:!0,children:l.map(s=>t.jsxs(x,{onClick:()=>{return t=s.id,_(t),void(null==e||e(A));var t},dense:!0,children:[t.jsx(j,{children:t.jsx(f,{edge:"start",checked:A.has(s.id),tabIndex:-1,disableRipple:!0})}),t.jsx(u,{primary:s.name,secondary:s.id,primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"}}),s.state&&t.jsx(d,{label:s.state,size:"small",variant:"outlined"})]},s.id))})]},s))})]})})})};export{$ as EntitySelector};
