import{i as e,j as t,S as a,A as n,y as r,c as i,B as o,I as s,z as l,E as d,F as c,G as u,T as h,H as m,J as p,K as x,M as y,N as f,O as v,t as g,Q as b,R as j,h as C,U as w,W as A,X as M,Y as k,Z as z,$,a0 as E,a1 as I}from"./mui-bZH-AYFI.js";import{r as S,a as D}from"./vendor-DtzNP0b0.js";import{F as R}from"./virtualization-B-nrxyRE.js";import{r as P,u as _,S as L,a as O}from"./index-fo0tzV7o.js";import{d as F,a as W}from"./Delete-Bqi5MThO.js";import{u as q}from"./useApi-CaRQlFkf.js";import{EntitySelector as T}from"./EntitySelector-DrDJuZO2.js";import{o as H,s as V,a as U,e as N}from"./state-MbgKLSXQ.js";import"./utils-D1Jy8hEJ.js";import"./helpers-F_j2KFUt.js";var Q={},Y=e;Object.defineProperty(Q,"__esModule",{value:!0});var B=Q.default=void 0,G=Y(P()),K=t;B=Q.default=(0,G.default)((0,K.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var Z={},J=e;Object.defineProperty(Z,"__esModule",{value:!0});var X=Z.default=void 0,ee=J(P()),te=t;X=Z.default=(0,ee.default)((0,te.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var ae={},ne=e;Object.defineProperty(ae,"__esModule",{value:!0});var re=ae.default=void 0,ie=ne(P()),oe=t;re=ae.default=(0,ie.default)((0,oe.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");var se={},le=e;Object.defineProperty(se,"__esModule",{value:!0});var de=se.default=void 0,ce=le(P()),ue=t;de=se.default=(0,ce.default)((0,ue.jsx)("path",{fillRule:"evenodd",d:"M3 3v8h8V3zm6 6H5V5h4zm-6 4v8h8v-8zm6 6H5v-4h4zm4-16v8h8V3zm6 6h-4V5h4zm-6 4v8h8v-8zm6 6h-4v-4h4z"}),"GridView");var he={},me=e;Object.defineProperty(he,"__esModule",{value:!0});var pe=he.default=void 0,xe=me(P()),ye=t;pe=he.default=(0,xe.default)((0,ye.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var fe={},ve=e;Object.defineProperty(fe,"__esModule",{value:!0});var ge=fe.default=void 0,be=ve(P()),je=t;ge=fe.default=(0,be.default)((0,je.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var Ce={},we=e;Object.defineProperty(Ce,"__esModule",{value:!0});var Ae=Ce.default=void 0,Me=we(P()),ke=t;Ae=Ce.default=(0,Me.default)((0,ke.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");var ze={},$e=e;Object.defineProperty(ze,"__esModule",{value:!0});var Ee=ze.default=void 0,Ie=$e(P()),Se=t;Ee=ze.default=(0,Ie.default)([(0,Se.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,Se.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime");var De={},Re=e;Object.defineProperty(De,"__esModule",{value:!0});var Pe=De.default=void 0,_e=Re(P()),Le=t;Pe=De.default=(0,_e.default)((0,Le.jsx)("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"}),"FolderOpen");var Oe={},Fe=e;Object.defineProperty(Oe,"__esModule",{value:!0});var We=Oe.default=void 0,qe=Fe(P()),Te=t;We=Oe.default=(0,qe.default)([(0,Te.jsx)("path",{d:"m12 2-5.5 9h11z"},"0"),(0,Te.jsx)("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),(0,Te.jsx)("path",{d:"M3 13.5h8v8H3z"},"2")],"Category");var He={},Ve=e;Object.defineProperty(He,"__esModule",{value:!0});var Ue=He.default=void 0,Ne=Ve(P()),Qe=t;Ue=He.default=(0,Ne.default)((0,Qe.jsx)("path",{d:"M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28M3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.25.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.26-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.7-3.4 2.96-.08.14-.23.21-.39.21m6.25 12.07c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.23-1.05-2.73-1.05-4.34 0-2.97 2.54-5.39 5.66-5.39s5.66 2.42 5.66 5.39c0 .28-.22.5-.5.5s-.5-.22-.5-.5c0-2.42-2.09-4.39-4.66-4.39-2.57 0-4.66 1.97-4.66 4.39 0 1.44.32 2.77.93 3.85.64 1.15 1.08 1.64 1.85 2.42.19.2.19.51 0 .71-.11.1-.24.15-.37.15m7.17-1.85c-1.19 0-2.24-.3-3.1-.89-1.49-1.01-2.38-2.65-2.38-4.39 0-.28.22-.5.5-.5s.5.22.5.5c0 1.41.72 2.74 1.94 3.56.71.48 1.54.71 2.54.71.24 0 .64-.03 1.04-.1.27-.05.53.13.58.41.05.27-.13.53-.41.58-.57.11-1.07.12-1.21.12M14.91 22c-.04 0-.09-.01-.13-.02-1.59-.44-2.63-1.03-3.72-2.1-1.4-1.39-2.17-3.24-2.17-5.22 0-1.62 1.38-2.94 3.08-2.94 1.7 0 3.08 1.32 3.08 2.94 0 1.07.93 1.94 2.08 1.94s2.08-.87 2.08-1.94c0-3.77-3.25-6.83-7.25-6.83-2.84 0-5.44 1.58-6.61 4.03-.39.81-.59 1.76-.59 2.8 0 .78.07 2.01.67 3.61.1.26-.03.55-.29.64-.26.1-.55-.04-.64-.29-.49-1.31-.73-2.61-.73-3.96 0-1.2.23-2.29.68-3.24 1.33-2.79 4.28-4.6 7.51-4.6 4.55 0 8.25 3.51 8.25 7.83 0 1.62-1.38 2.94-3.08 2.94s-3.08-1.32-3.08-2.94c0-1.07-.93-1.94-2.08-1.94s-2.08.87-2.08 1.94c0 1.71.66 3.31 1.87 4.51.95.94 1.86 1.46 3.27 1.85.27.07.42.35.35.61-.05.23-.26.38-.47.38"}),"Fingerprint");var Ye={},Be=e;Object.defineProperty(Ye,"__esModule",{value:!0});var Ge=Ye.default=void 0,Ke=Be(P()),Ze=t;Ge=Ye.default=(0,Ke.default)((0,Ze.jsx)("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpward");var Je={},Xe=e;Object.defineProperty(Je,"__esModule",{value:!0});var et=Je.default=void 0,tt=Xe(P()),at=t;et=Je.default=(0,tt.default)((0,at.jsx)("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"}),"ArrowDownward");var nt={},rt=e;Object.defineProperty(nt,"__esModule",{value:!0});var it=nt.default=void 0,ot=rt(P()),st=t;it=nt.default=(0,ot.default)((0,st.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var lt={},dt=e;Object.defineProperty(lt,"__esModule",{value:!0});var ct=lt.default=void 0,ut=dt(P()),ht=t;ct=lt.default=(0,ut.default)((0,ht.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");const mt=({open:e,error:l,onClose:d,onAction:c,autoHideDuration:u=6e3})=>{if(!l)return null;return t.jsx(a,{open:e,autoHideDuration:u,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsxs(n,{severity:l.severity,onClose:d,sx:{width:"100%",minWidth:300,maxWidth:600},action:t.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[l.action&&c&&t.jsx(o,{color:"inherit",size:"small",onClick:()=>{null==c||c(),d()},startIcon:t.jsx(ct,{}),children:l.action}),t.jsx(s,{size:"small","aria-label":"close",color:"inherit",onClick:d,children:t.jsx(it,{fontSize:"small"})})]}),children:[t.jsx(r,{children:l.title}),l.message]})})},pt=({open:e,message:r,onClose:i,autoHideDuration:o=3e3})=>t.jsx(a,{open:e,autoHideDuration:o,onClose:i,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(n,{onClose:i,severity:"success",sx:{width:"100%"},children:r})});var xt={},yt=e;Object.defineProperty(xt,"__esModule",{value:!0});var ft=xt.default=void 0,vt=yt(P()),gt=t;ft=xt.default=(0,vt.default)((0,gt.jsx)("path",{d:"M22.99 9C19.15 5.16 13.8 3.76 8.84 4.78l2.52 2.52c3.47-.17 6.99 1.05 9.63 3.7zm-4 4c-1.29-1.29-2.84-2.13-4.49-2.56l3.53 3.53zM2 3.05 5.07 6.1C3.6 6.82 2.22 7.78 1 9l1.99 2c1.24-1.24 2.67-2.16 4.2-2.77l2.24 2.24C7.81 10.89 6.27 11.73 5 13v.01L6.99 15c1.36-1.36 3.14-2.04 4.92-2.06L18.98 20l1.27-1.26L3.29 1.79zM9 17l3 3 3-3c-1.65-1.66-4.34-1.66-6 0"}),"WifiOff");var bt={},jt=e;Object.defineProperty(bt,"__esModule",{value:!0});var Ct=bt.default=void 0,wt=jt(P()),At=t;Ct=bt.default=(0,wt.default)((0,At.jsx)("path",{d:"m1 9 2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9m8 8 3 3 3-3c-1.65-1.66-4.34-1.66-6 0m-4-4 2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13"}),"Wifi");var Mt={},kt=e;Object.defineProperty(Mt,"__esModule",{value:!0});var zt=Mt.default=void 0,$t=kt(P()),Et=t;zt=Mt.default=(0,$t.default)((0,Et.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M19 18H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h.71C7.37 7.69 9.48 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3s-1.34 3-3 3"}),"CloudQueue");const It=({online:e,queueSize:a,isProcessingQueue:r})=>t.jsxs(t.Fragment,{children:[t.jsx(l,{in:!e,children:t.jsx(n,{severity:"warning",icon:t.jsx(ft,{}),sx:{mb:2,borderRadius:2},children:t.jsxs(i,{display:"flex",alignItems:"center",gap:2,children:[t.jsx(i,{flex:1,children:"You are currently offline. Changes will be saved when connection is restored."}),a>0&&t.jsx(d,{icon:t.jsx(zt,{}),label:`${a} queued`,size:"small",color:"warning"})]})})}),t.jsx(l,{in:e&&r,children:t.jsx(n,{severity:"info",icon:t.jsx(Ct,{}),sx:{mb:2,borderRadius:2},children:t.jsxs(i,{children:["Syncing queued changes...",t.jsx(c,{sx:{mt:1}})]})})}),t.jsx(l,{in:e&&!r&&0===a})]});class St extends Error{constructor(e,t,a){super(e),this.attempts=t,this.lastError=a,this.name="RetryError"}}async function Dt(e,t={}){const{maxRetries:a=3,baseDelay:n=1e3,maxDelay:r=8e3,onRetry:i}=t;let o=new Error("Unknown error");for(let l=0;l<=a;l++)try{return await e()}catch(s){if(o=s instanceof Error?s:new Error(String(s)),l===a)break;const e=Math.min(n*Math.pow(2,l),r);null==i||i(l+1,o),await new Promise(t=>setTimeout(t,e))}throw new St(`Failed after ${a+1} attempts: ${o.message}`,a+1,o)}function Rt(e,t={}){var a,n,r,i;const{operation:o="operation",resource:s="resource"}=t;if("NetworkError"===e.name||(null==(a=e.message)?void 0:a.includes("fetch"))||(null==(n=e.message)?void 0:n.includes("network")))return{title:"Connection Error",message:"Cannot connect to server. Please check your internet connection and try again.",severity:"error",action:"Retry"};const l=e.status||(null==(r=e.response)?void 0:r.status);if(400===l)return{title:"Invalid Request",message:e.message||"The request contains invalid data. Please check your input and try again.",severity:"warning",action:"Fix Input"};if(401===l)return{title:"Authentication Required",message:"Your session has expired. Please log in again.",severity:"warning",action:"Log In"};if(403===l)return{title:"Permission Denied",message:`You don't have permission to ${o} this ${s}.`,severity:"warning",action:"Contact Admin"};if(404===l)return{title:"Not Found",message:`${s.charAt(0).toUpperCase()+s.slice(1)} not found. It may have been deleted.`,severity:"info",action:"Refresh"};if(408===l)return{title:"Request Timeout",message:"The request took too long. Please try again.",severity:"warning",action:"Retry"};if(409===l)return{title:"Conflict",message:e.message||"This operation conflicts with existing data.",severity:"warning",action:"Refresh"};if(422===l)return{title:"Validation Error",message:e.message||"Please check your input and try again.",severity:"warning",action:"Fix Input"};if(429===l)return{title:"Too Many Requests",message:"You are making too many requests. Please wait a moment and try again.",severity:"warning",action:"Wait"};if(l>=500)return{title:"Server Error",message:"A server error occurred. Our team has been notified. Please try again later.",severity:"error",action:"Retry Later"};if("RetryError"===e.name)return{title:"Operation Failed",message:`Failed after ${e.attempts} attempts. ${(null==(i=e.lastError)?void 0:i.message)||"Please try again."}`,severity:"error",action:"Retry"};if("ValidationError"===e.name||e.errors){return{title:"Validation Error",message:(Array.isArray(e.errors)?e.errors.join(", "):e.message)||"Please check your input.",severity:"warning",action:"Fix Input"}}return{title:"Error",message:e.message||"An unexpected error occurred. Please try again.",severity:"error",action:"Retry"}}H({ingressUrl:V().url("Invalid URL format"),accessToken:V().min(10,"Access token must be at least 10 characters")});const Pt=/^[a-zA-Z0-9\s\-]+$/;H({name:V().min(2,"Area name must be at least 2 characters").max(50,"Area name cannot exceed 50 characters").regex(Pt,"Area name can only contain letters, numbers, spaces, and hyphens").transform(e=>e.trim()),entityIds:U(V()).min(1,"At least one entity is required").default([])}),H({name:V().min(1,"Client name is required").max(50,"Client name too long"),deviceType:N(["phone","tablet","desktop"]),assignedAreas:U(V()).default([]),assignedDashboard:V().optional()});const _t=e=>e&&0!==e.trim().length?e.trim().length<2?"Area name must be at least 2 characters":e.length>50?"Area name cannot exceed 50 characters":Pt.test(e)?null:"Area name can only contain letters, numbers, spaces, and hyphens":"Area name is required",Lt=e=>e&&0!==e.length?null:"At least one entity is required";const Ot={"&:focus-visible":{outline:"3px solid #005fcc",outlineOffset:"2px",borderRadius:"4px"}},Ft=D.memo(({entityName:e,color:a,onMoveUp:n,onMoveDown:r,onDelete:o,isFirst:l,isLast:c})=>t.jsxs(i,{sx:{display:"inline-flex",alignItems:"center",gap:.5,p:.5,border:`1px solid ${p(a,.5)}`,borderRadius:2,backgroundColor:p(a,.08)},role:"group","aria-label":`Entity ${e} controls`,children:[t.jsx(d,{label:e,size:"small",variant:"outlined",sx:{fontSize:"0.875rem",borderColor:a,color:"#1a1a1a",fontWeight:500}}),t.jsxs(i,{sx:{display:"flex",gap:.25},role:"toolbar","aria-label":"Entity position controls",children:[t.jsx(A,{title:l?"Already at top":"Move up",children:t.jsx("span",{children:t.jsx(s,{size:"small",onClick:n,disabled:l,"aria-label":`Move ${e} up in list`,"aria-disabled":l,sx:{minWidth:48,minHeight:48,p:1.5,color:l?"#999999":"#1a1a1a","&:hover:not(:disabled)":{bgcolor:p(a,.15)},"&.Mui-disabled":{color:"#999999",opacity:.6},...Ot},children:t.jsx(Ge,{sx:{fontSize:18}})})})}),t.jsx(A,{title:c?"Already at bottom":"Move down",children:t.jsx("span",{children:t.jsx(s,{size:"small",onClick:r,disabled:c,"aria-label":`Move ${e} down in list`,"aria-disabled":c,sx:{minWidth:48,minHeight:48,p:1.5,color:c?"#999999":"#1a1a1a","&:hover:not(:disabled)":{bgcolor:p(a,.15)},"&.Mui-disabled":{color:"#999999",opacity:.6},...Ot},children:t.jsx(et,{sx:{fontSize:18}})})})}),t.jsx(A,{title:"Remove from area",children:t.jsx(s,{size:"small",onClick:o,"aria-label":`Remove ${e} from this area`,sx:{minWidth:48,minHeight:48,p:1.5,color:"#c62828","&:hover":{bgcolor:p("#c62828",.1)},...Ot},children:t.jsx(W,{sx:{fontSize:18}})})})]})]}),(e,t)=>e.id===t.id&&e.color===t.color&&e.entityName===t.entityName&&e.isFirst===t.isFirst&&e.isLast===t.isLast),Wt=({index:e,style:a,data:n})=>{const{entityIds:r,entities:i,color:o,onMoveUp:s,onMoveDown:l,onDelete:d,totalCount:c}=n,u=r[e],h=i.find(e=>e.id===u);return h?t.jsx("div",{style:{...a,padding:"4px 8px",boxSizing:"border-box"},role:"listitem","aria-label":`Entity ${e+1} of ${c}: ${h.name}`,children:t.jsx(Ft,{id:u,entityName:h.name,color:o,onMoveUp:()=>s(u),onMoveDown:()=>l(u),onDelete:()=>d(u),isFirst:0===e,isLast:e===c-1})}):null},qt=S.memo(({area:e,color:a,onEdit:n,onDelete:r,onDuplicate:c,onToggle:x,onMoveEntityUp:g,onMoveEntityDown:b,onDeleteEntity:D,entities:P,isReordering:_})=>{const[L,O]=S.useState(!1),[q,T]=S.useState(null),[H,V]=S.useState("Click to copy ID"),[U,N]=S.useState(!1),[Q,Y]=S.useState(null),[B,G]=S.useState(""),K=S.useMemo(()=>{var t;return(null==(t=e.entityIds)?void 0:t.length)||0},[e.entityIds]),Z=S.useMemo(()=>e.updatedAt?new Date(e.updatedAt).toLocaleDateString():"Recently",[e.updatedAt]),J=S.useCallback(async()=>{try{await navigator.clipboard.writeText(e.id),V("Copied!"),G(`Area ID ${e.id} copied to clipboard`),setTimeout(()=>{V("Click to copy ID"),G("")},2e3)}catch(t){console.error("Failed to copy ID:",t),V("Failed to copy"),G("Failed to copy Area ID to clipboard"),setTimeout(()=>{V("Click to copy ID"),G("")},2e3)}},[e.id]),X=S.useCallback(e=>{e.stopPropagation(),T(e.currentTarget)},[]),ee=S.useCallback(()=>{T(null)},[]),te=S.useCallback(e=>{ee(),e()},[ee]),ae=S.useCallback(e=>{Y(e),N(!0)},[]),ne=S.useCallback(()=>{Q&&D(Q),N(!1),Y(null)},[Q,D]),ie=S.useCallback(()=>{N(!1),Y(null)},[]);return t.jsxs(m,{component:"article","aria-label":`Area: ${e.name}`,sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",overflow:"visible",transition:"all 0.2s ease-in-out",borderTop:`4px solid ${a}`,opacity:_?.6:1,pointerEvents:_?"none":"auto","&:hover":{transform:_?"none":"translateY(-4px)",boxShadow:e=>`0 8px 24px ${p(a,.2)}`}},children:[t.jsx(i,{role:"status","aria-live":"polite","aria-atomic":"true",sx:{position:"absolute",left:-1e4,width:1,height:1,overflow:"hidden"},children:B}),t.jsx(i,{sx:{position:"absolute",top:0,left:0,right:0,height:4,background:`linear-gradient(90deg, ${a}, ${p(a,.6)})`}}),t.jsxs(w,{sx:{flexGrow:1,pt:3},children:[t.jsx(i,{mb:2,children:t.jsx(A,{title:H,arrow:!0,placement:"top",children:t.jsx(d,{icon:t.jsx(Ue,{"aria-hidden":"true"}),label:`ID: ${e.id}`,onClick:J,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),J())},size:"small",tabIndex:0,role:"button","aria-label":`Copy Area ID ${e.id} to clipboard`,sx:{backgroundColor:p(a,.12),color:"#1a1a1a",fontWeight:600,fontSize:"0.75rem",fontFamily:"monospace",cursor:"pointer",transition:"all 0.2s","&:hover":{backgroundColor:p(a,.25),transform:"scale(1.02)"},"& .MuiChip-icon":{color:a},...Ot}})})}),t.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[t.jsxs(i,{display:"flex",alignItems:"center",gap:1.5,children:[t.jsx(i,{sx:{width:48,height:48,borderRadius:2,background:`linear-gradient(135deg, ${p(a,.25)}, ${p(a,.1)})`,display:"flex",alignItems:"center",justifyContent:"center"},"aria-hidden":"true",children:t.jsx(de,{sx:{color:a,fontSize:24}})}),t.jsxs(i,{children:[t.jsx(h,{variant:"h6",component:"h2",fontWeight:600,gutterBottom:!0,sx:{color:"#1a1a1a"},children:e.name}),t.jsxs(i,{display:"flex",alignItems:"center",gap:.5,children:[t.jsx(Ee,{sx:{fontSize:14,color:"text.secondary"},"aria-hidden":"true"}),t.jsxs(h,{variant:"caption",color:"text.secondary",children:["Last modified: ",Z]})]})]})]}),t.jsxs(i,{display:"flex",alignItems:"center",gap:.5,children:[_&&t.jsx(C,{size:20,sx:{mr:1},"aria-label":"Reordering entities"}),t.jsx(s,{size:"small",onClick:X,disabled:_,"aria-label":`Open menu for ${e.name}`,"aria-haspopup":"menu","aria-expanded":Boolean(q),sx:{transition:"all 0.2s","&:hover":{backgroundColor:p(a,.1)},...Ot},children:t.jsx(re,{})})]}),t.jsxs(M,{anchorEl:q,open:Boolean(q),onClose:ee,"aria-label":`Actions for ${e.name}`,children:[t.jsxs(k,{onClick:()=>te(n),"aria-label":`Edit ${e.name}`,children:[t.jsx(F,{fontSize:"small",sx:{mr:1},"aria-hidden":"true"}),"Edit Area"]}),t.jsxs(k,{onClick:()=>te(c),"aria-label":`Duplicate ${e.name}`,children:[t.jsx(Ae,{fontSize:"small",sx:{mr:1},"aria-hidden":"true"}),"Duplicate"]}),t.jsx(z,{}),t.jsxs(k,{onClick:()=>te(r),sx:{color:"#c62828"},"aria-label":`Delete ${e.name}`,children:[t.jsx(W,{fontSize:"small",sx:{mr:1},"aria-hidden":"true"}),"Delete"]})]})]}),t.jsx(i,{display:"flex",alignItems:"center",gap:1,mb:2,children:t.jsx($,{control:t.jsx(E,{checked:!1!==e.isEnabled,onChange:t=>{x(t.target.checked),G(`Area ${e.name} ${t.target.checked?"enabled":"disabled"}`)},color:"success",size:"small",inputProps:{"aria-label":`${!1!==e.isEnabled?"Disable":"Enable"} ${e.name}`},sx:Ot}),label:t.jsx(h,{variant:"caption",color:"text.secondary",children:!1!==e.isEnabled?"Enabled":"Disabled"})})}),t.jsxs(i,{mb:2,children:[t.jsx(d,{icon:t.jsx(We,{"aria-hidden":"true"}),label:`${K} ${1===K?"Entity":"Entities"}`,size:"small",sx:{backgroundColor:p(a,.12),color:"#1a1a1a",fontWeight:600},"aria-label":`This area contains ${K} ${1===K?"entity":"entities"}`}),K>0&&t.jsx(h,{variant:"caption",color:"text.secondary",display:"block",mt:1,component:"p",id:`area-${e.id}-instructions`,children:"Use arrow buttons or keyboard (Tab to navigate, Enter/Space to activate) to reorder entities"})]}),0===K?t.jsx(h,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},role:"status",children:"No entities in this area"}):t.jsx(i,{role:"region","aria-label":`Entities in ${e.name}`,"aria-describedby":`area-${e.id}-instructions`,children:!L&&K<=3?t.jsx(u,{spacing:1,mb:1,role:"list","aria-label":"Entity list",children:(e.entityIds||[]).map((n,r)=>{var o;const s=P.find(e=>e.id===n),l=(null==(o=e.entityIds)?void 0:o.length)||0;return s?t.jsx(i,{role:"listitem",children:t.jsx(Ft,{id:n,entityName:s.name,color:a,onMoveUp:()=>{g(n),G(`Moved ${s.name} up`)},onMoveDown:()=>{b(n),G(`Moved ${s.name} down`)},onDelete:()=>ae(n),isFirst:0===r,isLast:r===l-1})},n):null})}):L?t.jsxs(l,{in:L,children:[t.jsx(z,{sx:{my:2}}),t.jsxs(h,{variant:"caption",color:"text.secondary",display:"block",mb:1,component:"h3",sx:{fontWeight:600},children:["All Entities (",K," total):"]}),t.jsx(i,{sx:{border:`1px solid ${p(a,.3)}`,borderRadius:1,overflow:"hidden"},role:"list","aria-label":"Complete entity list",children:t.jsx(R,{height:Math.min(600,60*K),itemCount:K,itemSize:60,width:"100%",itemData:{entityIds:e.entityIds||[],entities:P,color:a,onMoveUp:e=>{g(e);const t=P.find(t=>t.id===e);t&&G(`Moved ${t.name} up`)},onMoveDown:e=>{b(e);const t=P.find(t=>t.id===e);t&&G(`Moved ${t.name} down`)},onDelete:ae,totalCount:K},children:Wt})})]}):t.jsxs(u,{spacing:1,mb:1,role:"list","aria-label":"Entity list preview",children:[(e.entityIds||[]).slice(0,3).map((n,r)=>{var o;const s=P.find(e=>e.id===n),l=(null==(o=e.entityIds)?void 0:o.length)||0;return s?t.jsx(i,{role:"listitem",children:t.jsx(Ft,{id:n,entityName:s.name,color:a,onMoveUp:()=>{g(n),G(`Moved ${s.name} up`)},onMoveDown:()=>{b(n),G(`Moved ${s.name} down`)},onDelete:()=>ae(n),isFirst:0===r,isLast:r===l-1})},n):null}),K>3&&t.jsx(d,{label:`+${K-3} more`,size:"small",variant:"outlined",sx:{fontSize:"0.875rem",color:"#1a1a1a"},"aria-label":K-3+" more entities. Click Show All to view."})]})})]}),K>3&&t.jsx(I,{sx:{justifyContent:"center",pt:0},children:t.jsx(o,{size:"small",onClick:()=>{O(!L),G(L?"Collapsed entity list":"Expanded entity list")},endIcon:L?t.jsx(ge,{"aria-hidden":"true"}):t.jsx(pe,{"aria-hidden":"true"}),sx:{color:"#1a1a1a",fontWeight:500,...Ot},disabled:_,"aria-expanded":L,"aria-label":L?"Show less entities":`Show all ${K} entities`,children:L?"Show Less":"Show All"})}),t.jsxs(y,{open:U,onClose:ie,"aria-labelledby":"delete-entity-dialog-title",children:[t.jsx(f,{id:"delete-entity-dialog-title",children:"Remove Entity from Area?"}),t.jsx(v,{children:t.jsx(h,{children:"Are you sure you want to remove this entity from the area? The entity itself will not be deleted."})}),t.jsxs(j,{children:[t.jsx(o,{onClick:ie,children:"Cancel"}),t.jsx(o,{onClick:ne,color:"error",variant:"contained",children:"Remove"})]})]})]})}),Tt=()=>{const{areas:e,entities:a,selectedEntities:r,setAreas:s}=_(),{createArea:l,updateArea:c,deleteArea:w,loading:A}=q(),M=D.useMemo(()=>Array.isArray(e)?e:(console.error("[AreaManager] areas is not an array:",e),[]),[e]),[k,z]=S.useState(!1),[$,E]=S.useState(null),[I,R]=S.useState(""),[P,F]=S.useState(!1),[W,H]=S.useState(null),[V,U]=S.useState(0),N=S.useRef(null),[Q,Y]=S.useState(null),[G,K]=S.useState(null),{status:Z,queueOperation:J,queueSize:ee,isProcessingQueue:te}=function(){const[e,t]=S.useState(()=>({online:navigator.onLine})),[a,n]=S.useState([]),[r,i]=S.useState(!1),o=S.useCallback(()=>{const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t({online:navigator.onLine,effectiveType:null==e?void 0:e.effectiveType,downlink:null==e?void 0:e.downlink,rtt:null==e?void 0:e.rtt})},[]),s=S.useCallback(async()=>{if(!navigator.onLine||0===a.length||r)return;i(!0);const e=[];for(const n of a)try{await n.operation(),console.log(`Successfully processed queued operation: ${n.id}`)}catch(t){console.error(`Failed to process queued operation: ${n.id}`,t),n.retryCount<n.maxRetries?e.push({...n,retryCount:n.retryCount+1}):console.error(`Max retries reached for operation: ${n.id}`)}n(e),i(!1)},[a,r]),l=S.useCallback((e,t,a=3)=>{n(n=>[...n,{id:e,operation:t,retryCount:0,maxRetries:a}])},[]),d=S.useCallback(()=>{n([])},[]);return S.useEffect(()=>{const e=()=>{o(),s()},t=()=>{o()},a=()=>{o()};window.addEventListener("online",e),window.addEventListener("offline",t);const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return null==n||n.addEventListener("change",a),o(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t),null==n||n.removeEventListener("change",a)}},[o,s]),S.useEffect(()=>{e.online&&a.length>0&&!r&&s()},[e.online,a.length,r,s]),{status:e,queue:a,queueOperation:l,clearQueue:d,queueSize:a.length,isProcessingQueue:r}}(),[ae,ne]=S.useState({open:!1,error:null}),[re,ie]=S.useState({open:!1,message:""});S.useEffect(()=>{k&&Y(_t(I))},[I,k]),S.useEffect(()=>{k&&K(Lt(Array.from(r)))},[r,k]);const oe=S.useCallback(()=>{E(null),R(""),Y(null),K(null),z(!0)},[]),se=S.useCallback(e=>{E(e),R(e.name),Y(null),K(null),z(!0)},[]),le=async()=>{const e=_t(I),t=Lt(Array.from(r));if(e)return void Y(e);if(t)return void K(t);const a=async()=>{const e=$?"update":"create";try{const e=await Dt(async()=>$?await c($.id,{name:I.trim(),entityIds:Array.from(r)}):await l({name:I.trim(),entityIds:Array.from(r)}),{maxRetries:3,baseDelay:1e3,onRetry:e=>{U(e)}});s($?t=>t.map(t=>t.id===e.id?e:t):t=>[...t,e]),ie({open:!0,message:`Area ${$?"updated":"created"} successfully`}),z(!1),E(null),R(""),U(0)}catch(t){console.error("Failed to save area:",t);const a=Rt(t,{operation:e,resource:"area"});ne({open:!0,error:a,retryAction:()=>le()})}};Z.online?await a():(J(`save-area-${Date.now()}`,a),ie({open:!0,message:"Operation queued. Will sync when online."}),z(!1))},de=async e=>{if(!confirm("Are you sure you want to delete this area?"))return;const t=async()=>{const t=[...M];try{s(t=>t.filter(t=>t.id!==e)),await Dt(()=>w(e),{maxRetries:3,baseDelay:1e3,onRetry:e=>U(e)}),ie({open:!0,message:"Area deleted successfully"}),U(0)}catch(a){console.error("Failed to delete area:",a),s(t);const n=Rt(a,{operation:"delete",resource:"area"});ne({open:!0,error:n,retryAction:()=>de(e)})}};Z.online?await t():(J(`delete-area-${e}`,t),ie({open:!0,message:"Delete queued. Will sync when online."}))},ce=async(e,t)=>{const a=async()=>{const a=[...M];try{s(a=>a.map(a=>a.id===e?{...a,isEnabled:t}:a));const a=await Dt(()=>O.patch(`/areas/${e}/toggle`,{enabled:t}),{maxRetries:3,baseDelay:1e3,onRetry:e=>U(e)});s(e=>e.map(e=>e.id===a.id?a:e)),ie({open:!0,message:`Area ${t?"enabled":"disabled"} successfully`}),U(0)}catch(n){console.error("Failed to toggle area:",n),s(a);const r=Rt(n,{operation:"toggle",resource:"area"});ne({open:!0,error:r,retryAction:()=>ce(e,t)})}};Z.online?await a():(J(`toggle-area-${e}`,a),ie({open:!0,message:"Toggle queued. Will sync when online."}))},ue=async e=>{const t=async()=>{try{const t=await Dt(()=>l({name:`${e.name} (Copy)`,entityIds:e.entityIds||[]}),{maxRetries:3,baseDelay:1e3,onRetry:e=>U(e)});s(e=>[...e,t]),ie({open:!0,message:"Area duplicated successfully"}),U(0)}catch(t){console.error("Failed to duplicate area:",t);const a=Rt(t,{operation:"duplicate",resource:"area"});ne({open:!0,error:a,retryAction:()=>ue(e)})}};Z.online?await t():(J(`duplicate-area-${e.id}`,t),ie({open:!0,message:"Duplicate queued. Will sync when online."}))},he=async(e,t)=>{const a=M.find(t=>t.id===e);if(!a||!a.entityIds)return;const n=a.entityIds.indexOf(t);if(n<=0)return;const r=[...M],i=[...a.entityIds];[i[n-1],i[n]]=[i[n],i[n-1]],s(t=>t.map(t=>t.id===e?{...t,entityIds:i}:t)),H(e);try{await Dt(()=>O.patchArea(e,{entityIds:i}),{maxRetries:3,baseDelay:1e3,onRetry:e=>U(e)}),ie({open:!0,message:"Entity moved up"}),U(0)}catch(o){console.error("Failed to move entity up:",o),s(r);const a=Rt(o,{operation:"reorder",resource:"entities"});ne({open:!0,error:a,retryAction:()=>he(e,t)})}finally{H(null)}},me=async(e,t)=>{const a=M.find(t=>t.id===e);if(!a||!a.entityIds)return;const n=a.entityIds.indexOf(t);if(-1===n||n>=a.entityIds.length-1)return;const r=[...M],i=[...a.entityIds];[i[n],i[n+1]]=[i[n+1],i[n]],s(t=>t.map(t=>t.id===e?{...t,entityIds:i}:t)),H(e);try{await Dt(()=>O.patchArea(e,{entityIds:i}),{maxRetries:3,baseDelay:1e3,onRetry:e=>U(e)}),ie({open:!0,message:"Entity moved down"}),U(0)}catch(o){console.error("Failed to move entity down:",o),s(r);const a=Rt(o,{operation:"reorder",resource:"entities"});ne({open:!0,error:a,retryAction:()=>me(e,t)})}finally{H(null)}},pe=async(e,t)=>{const a=M.find(t=>t.id===e);if(!a||!a.entityIds)return;const n=[...M],r=a.entityIds.filter(e=>e!==t);s(t=>t.map(t=>t.id===e?{...t,entityIds:r}:t)),H(e);try{await Dt(()=>O.patchArea(e,{entityIds:r}),{maxRetries:3,baseDelay:1e3,onRetry:e=>U(e)}),ie({open:!0,message:"Entity removed from area"}),U(0)}catch(i){console.error("Failed to remove entity:",i),s(n);const a=Rt(i,{operation:"remove",resource:"entity"});ne({open:!0,error:a,retryAction:()=>pe(e,t)})}finally{H(null)}},xe=S.useCallback(()=>{ne({open:!1,error:null})},[]),ye=S.useCallback(()=>{ie({open:!1,message:""})},[]);return t.jsx(L,{sectionName:"Area Manager",children:t.jsxs(i,{children:[t.jsx(i,{component:"a",href:"#main-content",sx:{position:"absolute",left:-1e4,top:"auto",width:1,height:1,overflow:"hidden","&:focus":{position:"fixed",top:0,left:0,width:"auto",height:"auto",padding:2,backgroundColor:"#005fcc",color:"#ffffff",zIndex:9999,textDecoration:"none",borderRadius:1}},onClick:e=>{var t;e.preventDefault(),null==(t=N.current)||t.focus()},children:"Skip to main content"}),t.jsxs(u,{spacing:3,ref:N,tabIndex:-1,id:"main-content",children:[t.jsx(It,{online:Z.online,queueSize:ee,isProcessingQueue:te}),V>0&&t.jsxs(n,{severity:"info",sx:{borderRadius:2},children:["Retrying operation... (Attempt ",V,"/3)"]}),t.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",component:"header",role:"banner",children:[t.jsxs(i,{children:[t.jsx(h,{variant:"h4",component:"h1",fontWeight:700,gutterBottom:!0,sx:{color:"#1a1a1a"},children:"Area Management"}),t.jsx(h,{variant:"body2",color:"text.secondary",component:"p",children:"Organize your entities into logical areas for better management"})]}),t.jsx(o,{variant:"contained",size:"large",startIcon:t.jsx(B,{"aria-hidden":"true"}),onClick:oe,"aria-label":"Create new area",sx:{borderRadius:2,px:3,background:"linear-gradient(135deg, #5568d3 0%, #63428a 100%)",color:"#ffffff",fontWeight:600,"&:hover":{background:"linear-gradient(135deg, #4557bc 0%, #522572 100%)"},...Ot},children:"Create Area"})]}),0===M.length?t.jsxs(m,{component:"section","aria-label":"Empty state",sx:{py:8,textAlign:"center",background:e=>`linear-gradient(135deg, ${p(e.palette.primary.main,.05)}, ${p(e.palette.secondary.main,.05)})`},children:[t.jsx(Pe,{sx:{fontSize:80,color:"text.secondary",opacity:.3,mb:2},"aria-hidden":"true"}),t.jsx(h,{variant:"h6",component:"h2",gutterBottom:!0,color:"text.secondary",children:"No areas created yet"}),t.jsx(h,{variant:"body2",color:"text.secondary",mb:3,component:"p",children:"Create your first area to organize entities into logical groups"}),t.jsx(o,{variant:"outlined",startIcon:t.jsx(B,{"aria-hidden":"true"}),onClick:oe,size:"large","aria-label":"Create your first area",sx:{...Ot,fontWeight:500},children:"Create Your First Area"})]}):t.jsx(x,{container:!0,spacing:3,component:"section","aria-label":"Areas list",children:M.map(e=>t.jsx(x,{item:!0,xs:12,sm:6,md:4,children:t.jsx(qt,{area:e,color:"#5568d3",onEdit:()=>se(e),onDelete:()=>de(e.id),onDuplicate:()=>ue(e),onToggle:t=>ce(e.id,t),onMoveEntityUp:t=>he(e.id,t),onMoveEntityDown:t=>me(e.id,t),onDeleteEntity:t=>pe(e.id,t),entities:a,isReordering:W===e.id})},e.id))}),M.length>0&&t.jsxs(i,{component:"footer",role:"contentinfo",sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:2,py:2},"aria-label":"Summary statistics",children:[t.jsx(d,{label:`${M.length} ${1===M.length?"Area":"Areas"}`,color:"primary",variant:"outlined",sx:{fontWeight:500},"aria-label":`Total: ${M.length} ${1===M.length?"area":"areas"}`}),t.jsx(d,{label:`${a.length} Total Entities`,color:"secondary",variant:"outlined",sx:{fontWeight:500},"aria-label":`Total: ${a.length} entities across all areas`})]})]}),t.jsxs(y,{open:k,onClose:()=>z(!1),maxWidth:"md",fullWidth:!0,"aria-labelledby":"area-dialog-title","aria-describedby":"area-dialog-description",children:[t.jsx(f,{id:"area-dialog-title",children:$?"Edit Area":"Create New Area"}),t.jsxs(v,{children:[t.jsx(h,{variant:"body2",color:"text.secondary",mb:2,id:"area-dialog-description",children:$?"Update the area name and entity assignments.":"Create a new area by providing a name and selecting entities to include."}),t.jsxs(u,{spacing:3,mt:1,children:[t.jsxs(i,{children:[t.jsx(g,{fullWidth:!0,label:"Area Name",value:I,onChange:e=>R(e.target.value),autoFocus:!0,error:!!Q,helperText:Q||"Min 2 chars, max 50 chars. Letters, numbers, spaces, and hyphens only.",required:!0,inputProps:{"aria-label":"Area name","aria-required":"true","aria-invalid":!!Q,"aria-describedby":Q?"name-error":"name-helper"},sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused fieldset":{borderColor:"#005fcc",borderWidth:2}}}}),Q&&t.jsx(b,{error:!0,id:"name-error",children:Q})]}),t.jsxs(i,{children:[t.jsxs(o,{variant:"outlined",onClick:()=>F(!P),fullWidth:!0,"aria-expanded":P,"aria-controls":"entity-selector-region","aria-label":`${P?"Hide":"Show"} entity selector. ${r.size} entities currently selected.`,sx:{...Ot,fontWeight:500},children:[P?"Hide":"Select"," Entities (",r.size," selected)"]}),G&&t.jsx(b,{error:!0,id:"entity-error",role:"alert",children:G})]}),P&&t.jsx(i,{id:"entity-selector-region",role:"region","aria-label":"Entity selection",children:t.jsx(T,{title:"Assign Entities to Area"})})]})]}),t.jsxs(j,{children:[t.jsx(o,{onClick:()=>z(!1),sx:Ot,children:"Cancel"}),t.jsx(o,{variant:"contained",onClick:le,disabled:!!Q||!!G||A,startIcon:A?t.jsx(C,{size:16,"aria-label":"Saving"}):t.jsx(X,{"aria-hidden":"true"}),"aria-label":A?"Saving area...":"Save area",sx:{...Ot,fontWeight:600},children:A?"Saving...":"Save"})]})]}),t.jsx(mt,{open:ae.open,error:ae.error,onClose:xe,onAction:ae.retryAction,autoHideDuration:6e3}),t.jsx(pt,{open:re.open,message:re.message,onClose:ye,autoHideDuration:3e3})]})})};export{Tt as AreaManager,Tt as AreaManagerEnhanced,Tt as default};
