import{i as e,j as i,c as a,G as n,T as r,aa as s,ab as t,ac as l,A as c,H as o,U as d,B as x,P as h,t as p,ad as j,ae as u,af as m,Y as g,E as v}from"./mui-bZH-AYFI.js";import{r as y}from"./vendor-DtzNP0b0.js";import{r as f,u as b,b as C,d as P,a as S}from"./index-fo0tzV7o.js";import{a as N}from"./useApi-CaRQlFkf.js";import"./state-MbgKLSXQ.js";import"./utils-D1Jy8hEJ.js";var w={},I=e;Object.defineProperty(w,"__esModule",{value:!0});var A=w.default=void 0,T=I(f()),W=i;A=w.default=(0,T.default)((0,W.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");const k=["Generate PIN","Waiting for Client","Assign Areas","Success"],z=()=>{const{areas:e,dashboards:f,selectedEntities:w,clearEntitySelection:I}=b(),{on:T}=C(),{loading:W,error:z,execute:D}=N(),[E,G]=y.useState(0),[L,B]=y.useState(null),[F,_]=y.useState(""),[M,R]=y.useState("phone"),[H,O]=y.useState([]),[U,V]=y.useState(""),[Y,q]=y.useState(null),[J,K]=y.useState(""),[Q,X]=y.useState(""),[Z,$]=y.useState(!1);y.useEffect(()=>{const e=T("pairing_verified",e=>{e.sessionId===(null==L?void 0:L.id)&&(K(e.deviceName),X(e.deviceType),_(e.deviceName),R(e.deviceType),G(2))});return()=>{e()}},[L,T]),y.useEffect(()=>{if(!L||1!==E)return void $(!1);const e=new Date(L.expiresAt).getTime()-Date.now();if(e<=0)return void $(!0);const i=setTimeout(()=>{$(!0)},e);return()=>clearTimeout(i)},[L,E]);const ee=()=>{G(0),B(null),_(""),R("phone"),O([]),V(""),q(null),K(""),X(""),$(!1),I()},ie=async()=>{if(L)try{await S.cancelPairing(L.id)}catch(e){console.error("Failed to cancel pairing:",e)}ee()};return i.jsx(a,{children:i.jsxs(n,{spacing:3,children:[i.jsx(r,{variant:"h5",children:"Client Pairing Wizard"}),i.jsx(s,{activeStep:E,children:k.map(e=>i.jsx(t,{children:i.jsx(l,{children:e})},e))}),z&&i.jsx(c,{severity:"error",children:z.message}),i.jsx(o,{children:i.jsxs(d,{children:[0===E&&i.jsxs(n,{spacing:3,alignItems:"center",py:4,children:[i.jsx(P,{sx:{fontSize:80,color:"primary.main"}}),i.jsx(r,{variant:"h6",children:"Ready to pair a new client"}),i.jsx(r,{color:"text.secondary",align:"center",children:'Click "Generate PIN" to create a pairing code for your client device'}),i.jsx(x,{variant:"contained",size:"large",onClick:async()=>{const e=await D(()=>S.createPairingSession());e&&(B(e),G(1))},disabled:W,children:"Generate PIN"})]}),1===E&&L&&i.jsxs(n,{spacing:3,alignItems:"center",py:4,children:[i.jsx(r,{variant:"h6",children:"Enter this PIN on your client device:"}),i.jsx(h,{elevation:3,sx:{p:4,bgcolor:Z?"error.main":"primary.main",color:"primary.contrastText"},children:i.jsx(r,{variant:"h2",fontWeight:"bold",letterSpacing:4,children:L.pin})}),Z?i.jsx(c,{severity:"error",sx:{width:"100%"},children:"PIN has expired. Please generate a new PIN."}):i.jsxs(i.Fragment,{children:[i.jsx(c,{severity:"info",sx:{width:"100%"},children:"Waiting for client to enter PIN..."}),i.jsxs(r,{variant:"caption",color:"text.secondary",children:["PIN expires: ",new Date(L.expiresAt).toLocaleTimeString()]})]}),i.jsx(x,{variant:"outlined",onClick:ie,children:Z?"Generate New PIN":"Cancel Pairing"})]}),2===E&&i.jsxs(n,{spacing:3,children:[i.jsxs(c,{severity:"success",children:["Client connected! Device: ",J," (",Q,")"]}),i.jsxs(h,{sx:{p:2,bgcolor:"background.default"},children:[i.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Connected Device Information"}),i.jsxs(n,{spacing:1,children:[i.jsxs(r,{variant:"body2",children:["Device Name: ",J]}),i.jsxs(r,{variant:"body2",children:["Device Type: ",Q]})]})]}),i.jsx(p,{fullWidth:!0,label:"Client Name",value:F,onChange:e=>_(e.target.value),placeholder:"e.g., Living Room Tablet",helperText:"Customize the display name for this client"}),i.jsxs(j,{fullWidth:!0,children:[i.jsx(u,{children:"Assigned Areas *"}),i.jsx(m,{multiple:!0,value:H,label:"Assigned Areas *",onChange:e=>O(e.target.value),renderValue:n=>i.jsx(a,{display:"flex",gap:.5,flexWrap:"wrap",children:n.map(a=>{var n;return i.jsx(v,{label:(null==(n=e.find(e=>e.id===a))?void 0:n.name)||a,size:"small"},a)})}),children:e.map(e=>i.jsx(g,{value:e.id,children:e.name},e.id))})]}),i.jsxs(a,{display:"flex",gap:2,justifyContent:"flex-end",children:[i.jsx(x,{onClick:ie,children:"Cancel"}),i.jsx(x,{variant:"contained",onClick:async()=>{if(L)try{const e=await S.completePairing(L.id,F,H);q(e),G(3),I()}catch(e){console.error("Failed to complete pairing:",e)}},disabled:!F.trim()||0===H.length,children:"Complete Pairing"})]})]}),3===E&&Y&&i.jsxs(n,{spacing:3,alignItems:"center",py:4,children:[i.jsx(A,{sx:{fontSize:80,color:"success.main"}}),i.jsx(r,{variant:"h6",children:"Pairing Complete!"}),i.jsxs(h,{sx:{p:3,bgcolor:"background.default",width:"100%"},children:[i.jsx(r,{variant:"subtitle2",gutterBottom:!0,color:"primary",children:"Client Details"}),i.jsxs(n,{spacing:2,mt:2,children:[i.jsxs(a,{children:[i.jsx(r,{variant:"body2",color:"text.secondary",children:"Name"}),i.jsx(r,{variant:"body1",fontWeight:"medium",children:Y.name})]}),i.jsxs(a,{children:[i.jsx(r,{variant:"body2",color:"text.secondary",children:"Device Type"}),i.jsx(r,{variant:"body1",fontWeight:"medium",children:Y.deviceType})]}),i.jsxs(a,{children:[i.jsx(r,{variant:"body2",color:"text.secondary",children:"Assigned Areas"}),i.jsx(a,{display:"flex",gap:.5,flexWrap:"wrap",mt:.5,children:H.length>0?H.map(a=>{var n;return i.jsx(v,{label:(null==(n=e.find(e=>e.id===a))?void 0:n.name)||a,size:"small",color:"primary",variant:"outlined"},a)}):i.jsx(r,{variant:"body1",children:"None"})})]})]})]}),i.jsx(x,{variant:"contained",onClick:ee,size:"large",children:"Pair Another Client"})]})]})})]})})};export{z as PairingWizard};
