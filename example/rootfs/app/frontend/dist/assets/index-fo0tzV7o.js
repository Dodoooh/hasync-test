const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginForm-DLqT_v1Z.js","assets/mui-bZH-AYFI.js","assets/vendor-DtzNP0b0.js","assets/EntitySelector-DrDJuZO2.js","assets/utils-D1Jy8hEJ.js","assets/helpers-F_j2KFUt.js","assets/state-MbgKLSXQ.js","assets/AreaManager-DcU43E05.js","assets/virtualization-B-nrxyRE.js","assets/Delete-Bqi5MThO.js","assets/useApi-CaRQlFkf.js","assets/ClientManagement-vnCX42VL.js","assets/PairingWizard-Bfa5DQwr.js","assets/Settings-fwQ2rmzU.js","assets/StatusBar-BHlHralJ.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{u as n,i as s,j as r,A as a,B as o,P as i,c,T as l,d,e as h,f as u,g,I as p,C as m,h as f,D as v,L as y,k as b,l as k,m as x,n as S,o as w,p as j,q as E,r as A,s as T}from"./mui-bZH-AYFI.js";import{c as C,g as _,r as z,a as I}from"./vendor-DtzNP0b0.js";import{c as P}from"./state-MbgKLSXQ.js";import{l as M,a as O}from"./utils-D1Jy8hEJ.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var D={},L=C;D.createRoot=L.createRoot,D.hydrateRoot=L.hydrateRoot;const R={},N=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in R)return;R[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,n&&r.setAttribute("nonce",n),document.head.appendChild(r),t?new Promise((t,n)=>{r.addEventListener("load",t),r.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};var $={},W={};const H=_(n);var F;function U(){return F||(F=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=H}(W)),W}var V=s;Object.defineProperty($,"__esModule",{value:!0});var B=$.default=void 0,q=V(U()),J=r;B=$.default=(0,q.default)((0,J.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var K={},G=s;Object.defineProperty(K,"__esModule",{value:!0});var X=K.default=void 0,Y=G(U()),Q=r;X=K.default=(0,Y.default)((0,Q.jsx)("path",{d:"M3 6h18V4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v-2H3zm10 6H9v1.78c-.61.55-1 1.33-1 2.22s.39 1.67 1 2.22V20h4v-1.78c.61-.55 1-1.34 1-2.22s-.39-1.67-1-2.22zm-2 5.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M22 8h-6c-.5 0-1 .5-1 1v10c0 .5.5 1 1 1h6c.5 0 1-.5 1-1V9c0-.5-.5-1-1-1m-1 10h-4v-8h4z"}),"DevicesOther");var Z={},ee=s;Object.defineProperty(Z,"__esModule",{value:!0});var te=Z.default=void 0,ne=ee(U()),se=r;te=Z.default=(0,ne.default)((0,se.jsx)("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard");var re={},ae=s;Object.defineProperty(re,"__esModule",{value:!0});var oe=re.default=void 0,ie=ae(U()),ce=r;oe=re.default=(0,ie.default)((0,ce.jsx)("path",{d:"M15 21h-2v-2h2zm-2-7h-2v5h2zm8-2h-2v4h2zm-2-2h-2v2h2zM7 12H5v2h2zm-2-2H3v2h2zm7-5h2V3h-2zm-7.5-.5v3h3v-3zM9 9H3V3h6zm-4.5 7.5v3h3v-3zM9 21H3v-6h6zm7.5-16.5v3h3v-3zM21 9h-6V3h6zm-2 10v-3h-4v2h2v3h4v-2zm-2-7h-4v2h4zm-4-2H7v2h2v2h2v-2h2zm1-1V7h-2V5h-2v4zM6.75 5.25h-1.5v1.5h1.5zm0 12h-1.5v1.5h1.5zm12-12h-1.5v1.5h1.5z"}),"QrCode2");var le={},de=s;Object.defineProperty(le,"__esModule",{value:!0});var he=le.default=void 0,ue=de(U()),ge=r;he=le.default=(0,ue.default)((0,ge.jsx)("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout");var pe={},me=s;Object.defineProperty(pe,"__esModule",{value:!0});var fe=pe.default=void 0,ve=me(U()),ye=r;fe=pe.default=(0,ve.default)((0,ye.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");const be={};function ke(e,t){let n;try{n=e()}catch(s){return}return{getItem:e=>{var t;const s=e=>null===e?null:JSON.parse(e,void 0),r=null!=(t=n.getItem(e))?t:null;return r instanceof Promise?r.then(s):s(r)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}const xe=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>xe(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>xe(e)(n)}}},Se=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?("production"!==(be?"production":void 0)&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),((e,t)=>(n,s,r)=>{let a={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const i=new Set,c=new Set;let l;try{l=a.getStorage()}catch(f){}if(!l)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...e)},s,r);const d=xe(a.serialize),h=()=>{const e=a.partialize({...s()});let t;const n=d({state:e,version:a.version}).then(e=>l.setItem(a.name,e)).catch(e=>{t=e});if(t)throw t;return n},u=r.setState;r.setState=(e,t)=>{u(e,t),h()};const g=e((...e)=>{n(...e),h()},s,r);let p;const m=()=>{var e;if(!l)return;o=!1,i.forEach(e=>e(s()));const t=(null==(e=a.onRehydrateStorage)?void 0:e.call(a,s()))||void 0;return xe(l.getItem.bind(l))(a.name).then(e=>{if(e)return a.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===a.version)return e.state;if(a.migrate)return a.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(e=>{var t;return p=a.merge(e,null!=(t=s())?t:g),n(p,!0),h()}).then(()=>{null==t||t(p,void 0),o=!0,c.forEach(e=>e(p))}).catch(e=>{null==t||t(void 0,e)})};return r.persist={setOptions:e=>{a={...a,...e},e.getStorage&&(l=e.getStorage())},clearStorage:()=>{null==l||l.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>m(),hasHydrated:()=>o,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},m(),p||g})(e,t)):((e,t)=>(n,s,r)=>{let a={storage:ke(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},o=!1;const i=new Set,c=new Set;let l=a.storage;if(!l)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...e)},s,r);const d=()=>{const e=a.partialize({...s()});return l.setItem(a.name,{state:e,version:a.version})},h=r.setState;r.setState=(e,t)=>{h(e,t),d()};const u=e((...e)=>{n(...e),d()},s,r);let g;r.getInitialState=()=>u;const p=()=>{var e,t;if(!l)return;o=!1,i.forEach(e=>{var t;return e(null!=(t=s())?t:u)});const r=(null==(t=a.onRehydrateStorage)?void 0:t.call(a,null!=(e=s())?e:u))||void 0;return xe(l.getItem.bind(l))(a.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===a.version)return[!1,e.state];if(a.migrate)return[!0,a.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[r,o]=e;if(g=a.merge(o,null!=(t=s())?t:u),n(g,!0),r)return d()}).then(()=>{null==r||r(g,void 0),g=s(),o=!0,c.forEach(e=>e(g))}).catch(e=>{null==r||r(void 0,e)})};return r.persist={setOptions:e=>{a={...a,...e},e.storage&&(l=e.storage)},clearStorage:()=>{null==l||l.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>p(),hasHydrated:()=>o,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},a.skipHydration||p(),g||u})(e,t),we=P()(Se((e,t)=>({isAuthenticated:!1,ingressUrl:"",accessToken:"",entities:[],areas:[],dashboards:[],clients:[],entityFilter:{search:"",types:[],areas:[],states:[],domains:[]},selectedEntities:new Set,selectedArea:null,selectedDashboard:null,selectedClient:null,loading:{entities:!1,areas:!1,dashboards:!1,clients:!1},errors:{entities:null,areas:null,dashboards:null,clients:null},setAuth:(t,n)=>e({isAuthenticated:!0,ingressUrl:t,accessToken:n}),clearAuth:()=>e({isAuthenticated:!1,ingressUrl:"",accessToken:"",entities:[],areas:[],dashboards:[],clients:[],selectedEntities:new Set,selectedArea:null,selectedDashboard:null,selectedClient:null,errors:{entities:null,areas:null,dashboards:null,clients:null}}),setEntities:n=>e({entities:n,loading:{...t().loading,entities:!1},errors:{...t().errors,entities:null}}),setAreas:t=>{if("function"==typeof t)e(e=>{const n=t(e.areas);return Array.isArray(n)?{areas:n}:(console.error("[useAppStore] setAreas function returned non-array:",n),e)});else{if(!Array.isArray(t))return void console.error("[useAppStore] setAreas called with non-array:",t);e({areas:t})}},setDashboards:t=>e({dashboards:t}),setClients:t=>e({clients:t}),updateEntity:t=>e(e=>({entities:e.entities.map(e=>e.id===t.id?t:e)})),updateClient:t=>e(e=>({clients:e.clients.map(e=>e.id===t.id?t:e)})),setEntityFilter:t=>e(e=>({entityFilter:{...e.entityFilter,...t}})),toggleEntitySelection:t=>e(e=>{const n=new Set(e.selectedEntities);return n.has(t)?n.delete(t):n.add(t),{selectedEntities:n}}),clearEntitySelection:()=>e({selectedEntities:new Set}),selectAllEntities:()=>e(e=>({selectedEntities:new Set(e.entities.map(e=>e.id))})),setSelectedArea:t=>e({selectedArea:t}),setSelectedDashboard:t=>e({selectedDashboard:t}),setSelectedClient:t=>e({selectedClient:t}),setLoading:(t,n)=>e(e=>({loading:{...e.loading,[t]:n}})),setError:(t,n)=>e(e=>({errors:{...e.errors,[t]:n},loading:{...e.loading,[t]:!1}})),clearErrors:()=>e({errors:{entities:null,areas:null,dashboards:null,clients:null}}),logEntities:()=>{const e=t();console.log("=== AppContext Entity Debug ==="),console.log("Total entities:",e.entities.length),console.log("Entities:",e.entities),console.log("Loading state:",e.loading.entities),console.log("Error state:",e.errors.entities),console.log("Selected entities:",Array.from(e.selectedEntities)),console.log("Entity filter:",e.entityFilter),console.log("==============================")},getEntityCount:()=>t().entities.length}),{name:"hasync-storage",partialize:e=>({ingressUrl:e.ingressUrl,accessToken:e.accessToken,entities:e.entities,areas:e.areas,dashboards:e.dashboards,clients:e.clients,entityFilter:e.entityFilter,selectedArea:e.selectedArea,selectedDashboard:e.selectedDashboard,selectedClient:e.selectedClient}),onRehydrateStorage:()=>e=>{e&&e.accessToken&&(e.isAuthenticated=!0)}}));const je=new class{constructor(){t(this,"socket",null),t(this,"handlers",new Map),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",5),t(this,"authToken",null)}setAuthToken(e){this.authToken=e}getAuthToken(){if(this.authToken)return this.authToken;try{return localStorage.getItem("auth_token")}catch{return null}}connect(e){var t;if(null==(t=this.socket)?void 0:t.connected)return void console.warn("WebSocket already connected");const n=this.getAuthToken();if(!n)return console.error("Cannot connect to WebSocket: No authentication token available"),void this.emit("error",{error:"No authentication token available. Please login first.",code:"NO_TOKEN",timestamp:new Date});console.log("Connecting to WebSocket with authentication token...");const s=e||`${window.location.protocol}//${window.location.hostname}:8099`;this.socket=M(s,{path:"/socket.io",transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:this.maxReconnectAttempts,auth:{token:n}}),this.socket.on("connect",()=>{console.log("WebSocket connected successfully"),this.reconnectAttempts=0,this.emit("connected",{timestamp:new Date,authenticated:!0})}),this.socket.on("disconnect",e=>{console.log("WebSocket disconnected:",e),this.emit("disconnected",{reason:e,timestamp:new Date})}),this.socket.on("connect_error",e=>{var t,n,s,r,a;return console.error("WebSocket connection error:",e),this.reconnectAttempts++,"NO_TOKEN"===(null==(t=e.data)?void 0:t.code)||"INVALID_TOKEN"===(null==(n=e.data)?void 0:n.code)?(console.error("WebSocket authentication failed:",e.message),this.emit("auth_error",{error:e.message,code:null==(s=e.data)?void 0:s.code,timestamp:new Date}),void this.disconnect()):"RATE_LIMIT_EXCEEDED"===(null==(r=e.data)?void 0:r.code)?(console.warn("WebSocket rate limit exceeded"),void this.emit("rate_limit",{error:e.message,timestamp:new Date})):void this.emit("error",{error:e.message,code:null==(a=e.data)?void 0:a.code,timestamp:new Date})}),this.socket.on("message",e=>{this.handleMessage(e)}),this.socket.on("entity_update",e=>{this.emit("entity_update",e)}),this.socket.on("client_connected",e=>{this.emit("client_connected",e)}),this.socket.on("client_disconnected",e=>{this.emit("client_disconnected",e)}),this.socket.on("pairing_request",e=>{this.emit("pairing_request",e)}),this.socket.on("config_update",e=>{this.emit("config_update",e)}),this.socket.on("error",e=>{console.error("WebSocket server error:",e),this.emit("server_error",e)}),this.socket.on("subscribed",e=>{console.log("Subscribed to:",e.type),this.emit("subscribed",e)}),this.socket.on("unsubscribed",e=>{console.log("Unsubscribed from:",e.type),this.emit("unsubscribed",e)}),this.socket.on("pong",e=>{this.emit("pong",e)})}disconnect(){this.socket&&(console.log("Disconnecting WebSocket..."),this.socket.disconnect(),this.socket=null),this.handlers.clear(),this.reconnectAttempts=0}on(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{const n=this.handlers.get(e);n&&(n.delete(t),0===n.size&&this.handlers.delete(e))}}once(e,t){const n=s=>{t(s),this.off(e,n)};this.on(e,n)}off(e,t){if(!t)return void this.handlers.delete(e);const n=this.handlers.get(e);n&&(n.delete(t),0===n.size&&this.handlers.delete(e))}send(e,t){var n;(null==(n=this.socket)?void 0:n.connected)?this.socket.emit(e,t):console.warn("WebSocket not connected, cannot send:",e)}handleMessage(e){this.emit(e.type,e.payload),this.emit("message",e)}emit(e,t){const n=this.handlers.get(e);n&&n.forEach(n=>{try{n(t)}catch(s){console.error(`Error in ${e} handler:`,s)}})}get isConnected(){var e;return(null==(e=this.socket)?void 0:e.connected)||!1}subscribe(e,t){this.send("subscribe",{type:e,id:t})}unsubscribe(e,t){this.send("unsubscribe",{type:e,id:t})}ping(){this.send("ping",{})}reconnectWithToken(e){this.setAuthToken(e),this.disconnect(),this.connect()}},Ee=()=>{const{updateEntity:e,updateClient:t}=we(),n=z.useCallback(()=>{je.connect()},[]),s=z.useCallback(()=>{je.disconnect()},[]);return z.useEffect(()=>{const n=je.on("entity_update",t=>{e(t.entity)}),s=je.on("client_connected",e=>{t(e.client)}),r=je.on("client_disconnected",e=>{t(e.client)});return()=>{n(),s(),r()}},[e,t]),{connect:n,disconnect:s,isConnected:je.isConnected,on:je.on.bind(je),send:je.send.bind(je)}};const Ae=new class{constructor(){t(this,"instance"),t(this,"baseURL"),t(this,"csrfToken",null),t(this,"accessToken",null),t(this,"tokenSetTime",0),this.baseURL="/api",this.instance=O.create({baseURL:this.baseURL,headers:{"Content-Type":"application/json"},withCredentials:!0}),this.instance.interceptors.request.use(async e=>{var t,n,s;return this.accessToken?(e.headers.Authorization=`Bearer ${this.accessToken}`,console.log(`[API] ${null==(t=e.method)?void 0:t.toUpperCase()} ${e.url} â†’ Token attached (${this.accessToken.substring(0,30)}...)`)):console.warn(`[API] ${null==(n=e.method)?void 0:n.toUpperCase()} ${e.url} â†’ NO TOKEN!`),["post","put","patch","delete"].includes((null==(s=e.method)?void 0:s.toLowerCase())||"")&&(this.csrfToken||await this.fetchCsrfToken(),this.csrfToken&&(e.headers["X-CSRF-Token"]=this.csrfToken)),e},e=>Promise.reject(e)),this.instance.interceptors.response.use(e=>e,async e=>{var t,n,s,r,a,o,i,c,l,d,h,u,g,p;if(403===(null==(t=e.response)?void 0:t.status)&&"EBADCSRFTOKEN"===(null==(s=null==(n=e.response)?void 0:n.data)?void 0:s.code)&&(this.csrfToken=null,await this.fetchCsrfToken(),e.config&&this.csrfToken))return e.config.headers["X-CSRF-Token"]=this.csrfToken,this.instance.request(e.config);401!==(null==(r=e.response)?void 0:r.status)||(null==(o=null==(a=e.config)?void 0:a.url)?void 0:o.includes("/auth/"))||(null==(c=null==(i=e.config)?void 0:i.url)?void 0:c.includes("/admin/"))||window.dispatchEvent(new Event("auth:expired"));const m={message:(null==(d=null==(l=e.response)?void 0:l.data)?void 0:d.message)||e.message||"An error occurred",code:(null==(u=null==(h=e.response)?void 0:h.data)?void 0:u.code)||e.code,details:null==(p=null==(g=e.response)?void 0:g.data)?void 0:p.details};return Promise.reject(m)}),this.initializeCsrfToken()}async fetchCsrfToken(){try{const e=await O.get(`${this.baseURL}/csrf-token`,{withCredentials:!0});this.csrfToken=e.data.csrfToken,console.log("âœ“ CSRF token fetched successfully")}catch(e){console.error("Failed to fetch CSRF token:",e),this.csrfToken=null}}async initializeCsrfToken(){await this.fetchCsrfToken()}setAuthToken(e){if(!e&&this.accessToken){if(Date.now()-(this.tokenSetTime||0)<1e3)return void console.warn("âš ï¸ Prevented token clear within 1s of setting - possible race condition")}this.accessToken=e,this.tokenSetTime=e?Date.now():0,console.log("âœ“ API client token updated:",e?`Token set (${e.substring(0,30)}...)`:"Token cleared")}async setAuth(e,t){await this.instance.post("/auth/login",{ingressUrl:e,token:t}),localStorage.setItem("ingressUrl",e)}async clearAuth(){try{await this.instance.post("/auth/logout")}catch(e){console.error("Logout request failed:",e)}localStorage.removeItem("ingressUrl")}async checkAuth(){var e;try{return!0===(null==(e=(await this.instance.get("/auth/status")).data.data)?void 0:e.authenticated)}catch(t){return!1}}async getConfig(){const{data:e}=await this.instance.get("/config");return e}async updateConfig(e){const{data:t}=await this.instance.put("/config",e);return t}async getEntities(){const e=localStorage.getItem("ingressUrl")||"",t=e?{ha_url:e}:{},{data:n}=await this.instance.get("/entities",{params:t});return n.map(e=>{var t;return{id:e.entity_id,name:e.friendly_name||(null==(t=e.attributes)?void 0:t.friendly_name)||e.entity_id,type:this.extractEntityType(e.entity_id),state:e.state,attributes:e.attributes}})}extractEntityType(e){return{light:"light",switch:"switch",sensor:"sensor",climate:"climate",cover:"cover",media_player:"media_player",camera:"camera"}[e.split(".")[0]]||"other"}async getEntity(e){const{data:t}=await this.instance.get(`/entities/${e}`);return t}async syncEntities(){const{data:e}=await this.instance.post("/entities/sync");return e}async getAreas(){const{data:e}=await this.instance.get("/areas");return e}async createArea(e){const{data:t}=await this.instance.post("/areas",e);return t}async updateArea(e,t){const{data:n}=await this.instance.put(`/areas/${e}`,t);return n}async deleteArea(e){await this.instance.delete(`/areas/${e}`)}async patchArea(e,t){const{data:n}=await this.instance.patch(`/areas/${e}`,t);return n}async assignEntitiesToArea(e,t){const{data:n}=await this.instance.post(`/areas/${e}/entities`,{entityIds:t});return n}async patch(e,t){return(await this.instance.patch(e,t)).data}async getDashboards(){const{data:e}=await this.instance.get("/dashboards");return e}async getDashboard(e){const{data:t}=await this.instance.get(`/dashboards/${e}`);return t}async syncDashboards(){const{data:e}=await this.instance.post("/dashboards/sync");return e}async getClients(){const{data:e}=await this.instance.get("/clients");return e}async getClient(e){const{data:t}=await this.instance.get(`/clients/${e}`);return t}async updateClient(e,t){const{data:n}=await this.instance.put(`/clients/${e}`,t);return n}async deleteClient(e){await this.instance.delete(`/clients/${e}`)}async assignAreasToClient(e,t){const{data:n}=await this.instance.post(`/clients/${e}/areas`,{areaIds:t});return n}async assignDashboardToClient(e,t){const{data:n}=await this.instance.post(`/clients/${e}/dashboard`,{dashboardId:t});return n}async revokeClientToken(e){await this.instance.post(`/clients/${e}/revoke`)}async getMyClientInfo(){const{data:e}=await this.instance.get("/clients/me");return e}async createPairingSession(){const{data:e}=await this.instance.post("/pairing/create");return e}async getPairingSession(e){const{data:t}=await this.instance.get(`/pairing/${e}`);return t}async verifyPairingPin(e,t,n,s){const{data:r}=await this.instance.post(`/pairing/${e}/verify`,{pin:t,deviceName:n,deviceType:s});return r}async completePairing(e,t,n){const{data:s}=await this.instance.post(`/pairing/${e}/complete`,{clientName:t,assignedAreas:n});return s}async cancelPairing(e){await this.instance.delete(`/pairing/${e}`)}async healthCheck(){const{data:e}=await this.instance.get("/health");return e}};var Te={},Ce=s;Object.defineProperty(Te,"__esModule",{value:!0});var _e=Te.default=void 0,ze=Ce(U()),Ie=r;_e=Te.default=(0,ze.default)((0,Ie.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline");class Pe extends z.Component{constructor(e){super(e),t(this,"logError",async(e,t)=>{try{await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e.message,stack:e.stack,componentStack:t.componentStack,level:this.props.level||"app",timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href})})}catch(n){console.error("Failed to log error:",n)}}),t(this,"trackError",(e,t)=>{console.log("Error tracked:",{error:e.message,component:t.componentStack})}),t(this,"handleReset",()=>{var e,t;this.setState({hasError:!1,error:null,errorInfo:null}),null==(t=(e=this.props).onReset)||t.call(e)}),this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error boundary caught:",e,t),this.setState(n=>({error:e,errorInfo:t,errorCount:n.errorCount+1})),this.logError(e,t),this.trackError(e,t)}renderFallback(){const{fallback:e,level:t="app"}=this.props,{error:n,errorInfo:s,errorCount:d}=this.state;return e||("component"===t?r.jsx(a,{severity:"error",action:r.jsx(o,{color:"inherit",size:"small",onClick:this.handleReset,children:"Retry"}),children:"Component failed to load"}):"section"===t?r.jsxs(i,{elevation:2,sx:{p:3,m:2},children:[r.jsxs(c,{display:"flex",alignItems:"center",mb:2,children:[r.jsx(_e,{color:"error",sx:{mr:1}}),r.jsx(l,{variant:"h6",children:"Section Error"})]}),r.jsx(l,{variant:"body2",mb:2,children:"This section encountered an error and couldn't be displayed."}),r.jsx(o,{variant:"contained",size:"small",onClick:this.handleReset,children:"Reload Section"})]}):r.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:3,sx:{backgroundColor:"#f5f5f5"},children:r.jsxs(i,{elevation:3,sx:{p:4,maxWidth:600},children:[r.jsxs(c,{display:"flex",alignItems:"center",mb:2,children:[r.jsx(_e,{color:"error",sx:{fontSize:48,mr:2}}),r.jsx(l,{variant:"h4",children:"Something went wrong"})]}),r.jsx(l,{variant:"body1",mb:2,children:"We're sorry, but something unexpected happened. Please try reloading the page."}),d>2&&r.jsx(a,{severity:"warning",sx:{mb:2},children:"Multiple errors detected. Consider refreshing the entire page."}),!1,r.jsxs(c,{display:"flex",gap:2,children:[r.jsx(o,{variant:"contained",color:"primary",onClick:this.handleReset,children:"Try Again"}),r.jsx(o,{variant:"outlined",onClick:()=>window.location.href="/",children:"Go Home"}),r.jsx(o,{variant:"outlined",onClick:()=>window.location.reload(),children:"Refresh Page"})]})]})}))}render(){return this.state.hasError?this.renderFallback():this.props.children}}const Me=({children:e,sectionName:t})=>r.jsx(Pe,{level:"section",fallback:r.jsx(a,{severity:"error",children:t?`Failed to load ${t}`:"Section failed to load"}),children:e}),Oe=({children:e,componentName:t})=>r.jsx(Pe,{level:"component",fallback:r.jsxs(a,{severity:"warning",sx:{my:1},children:[t||"Component"," unavailable"]}),children:e}),De=z.lazy(()=>N(()=>import("./LoginForm-DLqT_v1Z.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.LoginForm}))),Le=z.lazy(()=>N(()=>import("./EntitySelector-DrDJuZO2.js"),__vite__mapDeps([3,1,2,4,5,6])).then(e=>({default:e.EntitySelector}))),Re=z.lazy(()=>N(()=>import("./AreaManager-DcU43E05.js"),__vite__mapDeps([7,1,2,8,9,10,3,4,5,6])).then(e=>({default:e.AreaManager}))),Ne=z.lazy(()=>N(()=>import("./ClientManagement-vnCX42VL.js"),__vite__mapDeps([11,1,2,9,5,6,4])).then(e=>({default:e.ClientManagement}))),$e=z.lazy(()=>N(()=>import("./PairingWizard-Bfa5DQwr.js"),__vite__mapDeps([12,1,2,10,6,4])).then(e=>({default:e.PairingWizard}))),We=z.lazy(()=>N(()=>import("./Settings-fwQ2rmzU.js"),__vite__mapDeps([13,1,2,6,4])).then(e=>({default:e.Settings}))),He=z.lazy(()=>N(()=>import("./StatusBar-BHlHralJ.js"),__vite__mapDeps([14,1,2,6,4])).then(e=>({default:e.StatusBar}))),Fe=()=>r.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:r.jsx(f,{})}),Ue=[{label:"Entities",path:"/entities",icon:r.jsx(fe,{})},{label:"Areas",path:"/areas",icon:r.jsx(te,{})},{label:"Clients",path:"/clients",icon:r.jsx(X,{})},{label:"Pairing",path:"/pairing",icon:r.jsx(oe,{})},{label:"Settings",path:"/settings",icon:r.jsx(fe,{})}],Ve=()=>{const{isAuthenticated:e,accessToken:t,setAuth:n,clearAuth:s,setEntities:a,setAreas:i,setLoading:f}=we(),{connect:E,disconnect:A}=Ee(),T=d(),C=h(T.breakpoints.down("md")),[_,I]=z.useState(0),[P,M]=z.useState(!1);z.useEffect(()=>{console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ðŸŽ¨ HAsync Frontend v1.3.42"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("Build timestamp:",(new Date).toISOString()),console.log("User agent:",navigator.userAgent),console.log("Token sync fix:","v1.3.40 race condition guard active")},[]),z.useEffect(()=>{console.log("[App] Token sync effect triggered",{isAuthenticated:e,hasToken:!!t,tokenPreview:t?t.substring(0,30)+"...":"none"}),e&&t?(console.log("âœ“ Restoring API client token from store"),Ae.setAuthToken(t),je.setAuthToken(t)):e?console.log("âš ï¸ Authenticated but no token yet - waiting..."):(console.log("âœ— Not authenticated - clearing tokens"),Ae.setAuthToken(null),je.setAuthToken(null))},[e,t]),z.useEffect(()=>{(async()=>{if(e)try{f("entities",!0);const e=await Ae.getEntities();a(e),console.log("Entities fetched successfully:",e.length);const t=await Ae.getAreas();i(t),console.log("Areas fetched successfully:",t.length)}catch(t){console.error("Failed to fetch data:",t)}finally{f("entities",!1)}})()},[e,a,i,f]),z.useEffect(()=>{if(e){const{accessToken:e}=we.getState();if(e){console.log("Setting WebSocket token and connecting..."),je.setAuthToken(e);const t=setTimeout(()=>{E()},100);return()=>{clearTimeout(t),A()}}console.warn("Cannot connect WebSocket: No access token available")}else A()},[e,E,A]);const O=z.useCallback(()=>{console.log("Logging out, clearing tokens"),localStorage.removeItem("auth_token"),A(),Ae.setAuthToken(null),je.setAuthToken(null),s()},[s,A]),D=z.useCallback((e,t)=>{I(t),C&&M(!1)},[C]),L=z.useCallback(e=>{console.log("[Login] Login successful, setting auth token",{tokenPreview:e.substring(0,30)+"...",tokenLength:e.length}),Ae.setAuthToken(e),je.setAuthToken(e),console.log("[Login] âœ“ Tokens set in clients IMMEDIATELY"),e&&(localStorage.setItem("auth_token",e),console.log("[Login] âœ“ Token stored in localStorage")),n("",e),console.log("[Login] âœ“ Token set in Zustand state")},[n]),R=z.useCallback(()=>{const e=(()=>{switch(_){case 0:default:return r.jsx(Oe,{componentName:"Entity Selector",children:r.jsx(Le,{title:"All Entities"})});case 1:return r.jsx(Oe,{componentName:"Area Manager",children:r.jsx(Re,{})});case 2:return r.jsx(Oe,{componentName:"Client Management",children:r.jsx(Ne,{})});case 3:return r.jsx(Oe,{componentName:"Pairing Wizard",children:r.jsx($e,{})});case 4:return r.jsx(Oe,{componentName:"Settings",children:r.jsx(We,{})})}})();return r.jsx(z.Suspense,{fallback:r.jsx(Fe,{}),children:e})},[_]);if(!e)return r.jsx(z.Suspense,{fallback:r.jsx(Fe,{}),children:r.jsx(De,{onLogin:L})});const N=()=>r.jsx(r.Fragment,{children:C?r.jsx(v,{anchor:"left",open:P,onClose:()=>M(!1),children:r.jsx(c,{sx:{width:250},role:"presentation",children:r.jsx(y,{children:Ue.map((e,t)=>r.jsx(b,{disablePadding:!0,children:r.jsxs(k,{selected:_===t,onClick:()=>D({},t),children:[r.jsx(x,{children:e.icon}),r.jsx(S,{primary:e.label})]})},e.path))})})}):r.jsx(w,{value:_,onChange:D,sx:{flexGrow:1},textColor:"inherit",children:Ue.map(e=>r.jsx(j,{label:e.label,icon:e.icon,iconPosition:"start"},e.path))})});return r.jsxs(c,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[r.jsx(u,{position:"static",elevation:0,children:r.jsxs(g,{children:[C&&r.jsx(p,{edge:"start",color:"inherit",onClick:()=>M(!0),sx:{mr:2},children:r.jsx(B,{})}),r.jsx(l,{variant:"h6",component:"div",sx:{mr:2,fontWeight:700},children:"HAsync"}),r.jsx(N,{}),r.jsx(o,{color:"inherit",startIcon:r.jsx(he,{}),onClick:O,sx:{ml:"auto"},children:"Logout"})]})}),r.jsx(z.Suspense,{fallback:null,children:r.jsx(He,{})}),r.jsx(m,{maxWidth:"xl",sx:{mt:4,mb:4,flexGrow:1},children:R()})]})},Be=z.createContext({darkMode:!1,toggleDarkMode:()=>{}}),qe=()=>z.useContext(Be),Je=({children:e})=>{const[t,n]=z.useState(()=>{const e=localStorage.getItem("darkMode");return!e||JSON.parse(e)});z.useEffect(()=>{localStorage.setItem("darkMode",JSON.stringify(t))},[t]);const s=E({palette:{mode:t?"dark":"light",primary:{main:t?"#60a5fa":"#2563eb",light:t?"#93c5fd":"#60a5fa",dark:t?"#3b82f6":"#1e40af"},secondary:{main:t?"#a78bfa":"#7c3aed",light:t?"#c4b5fd":"#a78bfa",dark:t?"#8b5cf6":"#5b21b6"},success:{main:t?"#34d399":"#10b981"},error:{main:t?"#f87171":"#ef4444"},warning:{main:t?"#fbbf24":"#f59e0b"},background:{default:t?"#0f172a":"#f8fafc",paper:t?"#1e293b":"#ffffff"},text:{primary:t?"#f1f5f9":"#0f172a",secondary:t?"#94a3b8":"#64748b"}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontWeight:700,letterSpacing:"-0.02em"},h2:{fontWeight:700,letterSpacing:"-0.01em"},h3:{fontWeight:600,letterSpacing:"-0.01em"},h4:{fontWeight:600},h5:{fontWeight:600},h6:{fontWeight:600},button:{textTransform:"none",fontWeight:500}},shape:{borderRadius:12},components:{MuiCard:{styleOverrides:{root:{backgroundImage:"none",boxShadow:t?"0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3)":"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)",backdropFilter:t?"blur(12px)":"none",border:t?"1px solid rgba(255, 255, 255, 0.1)":"none"}}},MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"8px 16px",boxShadow:"none","&:hover":{boxShadow:t?"0 4px 6px -1px rgb(0 0 0 / 0.3)":"0 4px 6px -1px rgb(0 0 0 / 0.1)"}},contained:{"&:hover":{transform:"translateY(-1px)",transition:"all 0.2s ease-in-out"}}}},MuiChip:{styleOverrides:{root:{borderRadius:6,fontWeight:500}}},MuiAppBar:{styleOverrides:{root:{backgroundImage:"none",boxShadow:"none",borderBottom:t?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)"}}},MuiPaper:{styleOverrides:{root:{backgroundImage:"none"}}}}});return r.jsx(Be.Provider,{value:{darkMode:t,toggleDarkMode:()=>{n(!t)}},children:r.jsxs(A,{theme:s,children:[r.jsx(T,{}),e]})})};D.createRoot(document.getElementById("root")).render(r.jsx(I.StrictMode,{children:r.jsx(Pe,{level:"app",children:r.jsx(Je,{children:r.jsx(Ve,{})})})}));export{Me as S,Ae as a,Ee as b,qe as c,oe as d,U as r,we as u,je as w};
