import{i as e,j as i,c as r,G as a,T as n,aa as s,ab as t,ac as l,A as c,H as o,U as d,B as h,P as x,F as g,t as j,ad as u,ae as m,af as p,Y as v,E as f}from"./mui-bZH-AYFI.js";import{r as y}from"./vendor-DtzNP0b0.js";import{r as b,u as C,b as w,d as S,a as P}from"./index-C0CMstuU.js";import{d as k}from"./CheckCircle-DaUrYvHB.js";import{a as I}from"./useApi-PbBuRzGB.js";import"./state-MbgKLSXQ.js";import"./utils-D1Jy8hEJ.js";var N={},A=e;Object.defineProperty(N,"__esModule",{value:!0});var W=N.default=void 0,T=A(b()),z=i;W=N.default=(0,T.default)((0,z.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const D=["Generate PIN","Waiting for Client","Assign Areas","Success"],M=()=>{const{areas:e,dashboards:b,selectedEntities:N,clearEntitySelection:A}=C(),{on:T}=w(),{loading:z,error:M,execute:E}=I(),[R,G]=y.useState(0),[F,B]=y.useState(null),[_,H]=y.useState(""),[L,V]=y.useState("phone"),[O,U]=y.useState([]),[Y,q]=y.useState(""),[J,K]=y.useState(null),[Q,X]=y.useState(""),[Z,$]=y.useState(""),[ee,ie]=y.useState(!1),[re,ae]=y.useState(0);y.useEffect(()=>{const e=T("pairing_verified",e=>{e.sessionId===(null==F?void 0:F.id)&&(X(e.deviceName),$(e.deviceType),H(e.deviceName),V(e.deviceType),G(2))});return()=>{e()}},[F,T]),y.useEffect(()=>{if(!F||1!==R)return ie(!1),void ae(0);const e=()=>{const e=new Date(F.expiresAt).getTime(),i=Math.max(0,Math.floor((e-Date.now())/1e3));ae(i),i<=0&&ie(!0)};e();const i=setInterval(e,1e3);return()=>clearInterval(i)},[F,R]);const ne=()=>{G(0),B(null),H(""),V("phone"),U([]),q(""),K(null),X(""),$(""),ie(!1),ae(0),A()},se=async()=>{if(F)try{await P.cancelPairing(F.id)}catch(e){console.error("Failed to cancel pairing:",e)}ne()};return i.jsx(r,{children:i.jsxs(a,{spacing:3,children:[i.jsx(n,{variant:"h5",children:"Client Pairing Wizard"}),i.jsx(s,{activeStep:R,children:D.map(e=>i.jsx(t,{children:i.jsx(l,{children:e})},e))}),M&&i.jsx(c,{severity:"error",children:M.message}),i.jsx(o,{children:i.jsxs(d,{children:[0===R&&i.jsxs(a,{spacing:3,alignItems:"center",py:4,children:[i.jsx(S,{sx:{fontSize:80,color:"primary.main"}}),i.jsx(n,{variant:"h6",children:"Ready to pair a new client"}),i.jsx(n,{color:"text.secondary",align:"center",children:'Click "Generate PIN" to create a pairing code for your client device'}),i.jsx(h,{variant:"contained",size:"large",onClick:async()=>{const e=await E(()=>P.createPairingSession());e&&(B(e),G(1))},disabled:z,children:"Generate PIN"})]}),1===R&&F&&i.jsxs(a,{spacing:3,alignItems:"center",py:4,children:[i.jsx(n,{variant:"h6",children:"Enter this PIN on your client device:"}),i.jsx(x,{elevation:3,sx:{p:4,bgcolor:ee?"error.main":"primary.main",color:"primary.contrastText"},children:i.jsx(n,{variant:"h2",fontWeight:"bold",letterSpacing:4,children:F.pin})}),ee?i.jsx(c,{severity:"error",sx:{width:"100%"},children:"PIN has expired. Please generate a new PIN."}):i.jsxs(i.Fragment,{children:[i.jsxs(r,{sx:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[i.jsxs(x,{elevation:2,sx:{p:3,bgcolor:re>60?"success.light":re>30?"warning.light":"error.light",borderRadius:2,minWidth:200,textAlign:"center"},children:[i.jsxs(a,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1,children:[i.jsx(W,{sx:{fontSize:40,color:re>60?"success.dark":re>30?"warning.dark":"error.dark"}}),i.jsxs(n,{variant:"h3",fontWeight:"bold",sx:{color:re>60?"success.dark":re>30?"warning.dark":"error.dark"},children:[Math.floor(re/60),":",String(re%60).padStart(2,"0")]})]}),i.jsx(n,{variant:"subtitle1",sx:{mt:1,color:re>60?"success.dark":re>30?"warning.dark":"error.dark"},children:"Time Remaining"})]}),i.jsx(r,{sx:{width:"100%",maxWidth:400},children:i.jsx(g,{variant:"determinate",value:re/300*100,sx:{height:8,borderRadius:4,bgcolor:"grey.200","& .MuiLinearProgress-bar":{bgcolor:re>60?"success.main":re>30?"warning.main":"error.main",borderRadius:4}}})})]}),i.jsx(c,{severity:"info",sx:{width:"100%"},children:"Waiting for client to enter PIN..."})]}),i.jsx(h,{variant:"outlined",onClick:se,children:ee?"Generate New PIN":"Cancel Pairing"})]}),2===R&&i.jsxs(a,{spacing:3,children:[i.jsxs(c,{severity:"success",children:["Client connected! Device: ",Q," (",Z,")"]}),i.jsxs(x,{sx:{p:2,bgcolor:"background.default"},children:[i.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Connected Device Information"}),i.jsxs(a,{spacing:1,children:[i.jsxs(n,{variant:"body2",children:["Device Name: ",Q]}),i.jsxs(n,{variant:"body2",children:["Device Type: ",Z]})]})]}),i.jsx(j,{fullWidth:!0,label:"Client Name",value:_,onChange:e=>H(e.target.value),placeholder:"e.g., Living Room Tablet",helperText:"Customize the display name for this client"}),i.jsxs(u,{fullWidth:!0,children:[i.jsx(m,{children:"Assigned Areas *"}),i.jsx(p,{multiple:!0,value:O,label:"Assigned Areas *",onChange:e=>U(e.target.value),renderValue:a=>i.jsx(r,{display:"flex",gap:.5,flexWrap:"wrap",children:a.map(r=>{var a;return i.jsx(f,{label:(null==(a=e.find(e=>e.id===r))?void 0:a.name)||r,size:"small"},r)})}),children:e.map(e=>i.jsx(v,{value:e.id,children:e.name},e.id))})]}),i.jsxs(r,{display:"flex",gap:2,justifyContent:"flex-end",children:[i.jsx(h,{onClick:se,children:"Cancel"}),i.jsx(h,{variant:"contained",onClick:async()=>{if(F)try{const e=await P.completePairing(F.id,_,O);K(e),G(3),A()}catch(e){console.error("Failed to complete pairing:",e)}},disabled:!_.trim()||0===O.length,children:"Complete Pairing"})]})]}),3===R&&J&&i.jsxs(a,{spacing:3,alignItems:"center",py:4,children:[i.jsx(k,{sx:{fontSize:80,color:"success.main"}}),i.jsx(n,{variant:"h6",children:"Pairing Complete!"}),i.jsxs(x,{sx:{p:3,bgcolor:"background.default",width:"100%"},children:[i.jsx(n,{variant:"subtitle2",gutterBottom:!0,color:"primary",children:"Client Details"}),i.jsxs(a,{spacing:2,mt:2,children:[i.jsxs(r,{children:[i.jsx(n,{variant:"body2",color:"text.secondary",children:"Name"}),i.jsx(n,{variant:"body1",fontWeight:"medium",children:J.name})]}),i.jsxs(r,{children:[i.jsx(n,{variant:"body2",color:"text.secondary",children:"Device Type"}),i.jsx(n,{variant:"body1",fontWeight:"medium",children:J.deviceType})]}),i.jsxs(r,{children:[i.jsx(n,{variant:"body2",color:"text.secondary",children:"Assigned Areas"}),i.jsx(r,{display:"flex",gap:.5,flexWrap:"wrap",mt:.5,children:O.length>0?O.map(r=>{var a;return i.jsx(f,{label:(null==(a=e.find(e=>e.id===r))?void 0:a.name)||r,size:"small",color:"primary",variant:"outlined"},r)}):i.jsx(n,{variant:"body1",children:"None"})})]})]})]}),i.jsx(h,{variant:"contained",onClick:ne,size:"large",children:"Pair Another Client"})]})]})})]})})};export{M as PairingWizard};
